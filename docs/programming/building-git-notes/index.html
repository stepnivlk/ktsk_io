<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://ktsk.xyz/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://ktsk.xyz/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="stylesheet" href="https://ktsk.xyz/main.css">



  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>Building Git Notes | ktsk</title>
<meta name="description" content="Personal web of Tomas Koutsky">
<link rel="canonical" href="https://ktsk.xyz/docs/programming/building-git-notes/">










<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://ktsk.xyz/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Docs",
            "item": "https://ktsk.xyz/docs/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Programming",
            "item": "https://ktsk.xyz/docs/programming/"
          },
        
      
        
        
        
        
        
        
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Building Git Notes",
            "item": "https://ktsk.xyz/docs/programming/building-git-notes/"
          },
        
      
    
  }
</script>




  <meta name="theme-color" content="#fff">
  
  <link color="#5bbad5" href='&#x2F;icons&#x2F;safari-pinned-tab.svg' rel="mask-icon" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-16x16.png' rel="icon" sizes="16x16" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;favicon-32x32.png' rel="icon" sizes="32x32" type="image/png" />
  
  
  <link href='&#x2F;icons&#x2F;apple-touch-icon.png' rel="apple-touch-icon" sizes="180x180" />
  
  
    <link rel="manifest" href="https://ktsk.xyz/site.webmanifest">
  


  
    
      <script>
      // https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html
      window.MathJax = {
      	tex: {
      	inlineMath: [['$', '$'], ['\\(', '\\)']],
      	displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
      	processEscapes: true,
      	processEnvironments: true,
      	},
      	options: {
      	skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      	}
      };
      </script>
      <script  async defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>
    
  

</head>

  

<body class="docs single">
  
  
  
  
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://ktsk.xyz">ktsk</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="mailto:tomas@ktsk.xyz"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2.02c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm0 12.55l-5.992-4.57h11.983l-5.991 4.57zm0 1.288l-6-4.629v6.771h12v-6.771l-6 4.629z"/></svg><span class="ms-2 visually-hidden">Email</span></a>
					</li>
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/stepnivlk"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
						<li class="nav-item docs active">
							<a class="nav-link" href="https://ktsk.xyz/docs/home/intro/">wiki</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
				<form class="navbar-form flex-grow-1 order-7 order-md-3">
					<input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
						aria-label="Search docs..." autocomplete="off">
					<div id="suggestions" class="shadow bg-white rounded"></div>
				</form>
			
		</div>
	</div>
</header>



  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row flex-xl-nowrap">
	  
<div class="col-lg-5 col-xl-4 docs-sidebar">
	<nav class="docs-links" aria-label="Main navigation">
			
			
			
			
					
					
					
							<h3>~</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/home/intro/">Intro</a></li>
							
					</ul>
					
					
					
					
							<h3>Programming</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/programming/decoding-youtube-filters/">Decoding Youtube filters</a></li>
							                           
									<li><a class="docs-link active" href="https://ktsk.xyz/docs/programming/building-git-notes/">Building Git Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/programming/webpack-cache-bust/">Webpack - cache busting</a></li>
							
					</ul>
					
					
					
					
							<h3>Cheatsheets</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/cheatsheets/git-cheatsheet/">Git cheatsheet</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/cheatsheets/math-cheatsheet/">Math cheatsheet</a></li>
							
					</ul>
					
					
					
					
							<h3>Outdoors</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/outdoors/hiking-gr20/">How I hiked GR20</a></li>
							
					</ul>
					
					
					
					
							<h3>Uni</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mst124-unit6/">MST124 Unit 6 - Differentiation</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mst124-unit5/">MST124 Unit 5 - Coordinate geometry and vectors</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mst124-unit4/">MST124 Unit 4 - Trigonometry</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mst124-unit3/">MST124 Unit 3 - Functions</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mst124-unit2/">MST124 Unit 2 - Graphs and equations</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mst124-unit1/">MST124 Unit 1 - Algebra</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit14/">MU123 Unit 14 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit13/">MU123 Unit 13 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit12/">MU123 Unit 12 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit10/">MU123 Unit 10 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit9/">MU123 Unit 9 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/complex-numbers-notes/">Complex numbers Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit6/">MU123 Unit 6 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit5/">MU123 Unit 5 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit4/">MU123 Unit 4 Notes</a></li>
							                           
									<li><a class="docs-link" href="https://ktsk.xyz/docs/uni/mu123-unit3/">MU123 Unit 3 Notes</a></li>
							
					</ul>
					
					
			
	</nav>
</div>

	  
  
  <nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
  	<div class="page-links">
  			<h3>On this page</h3>
  			<nav id="TableOfContents">
  					<ul>
  							
  							<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#2-getting-to-know-git">2. Getting to know .git</a></li>
  							
  									<ul>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#2-1-the-git-directory">2.1 The .git directory</a></li>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#2-2-a-simple-commit">2.2 A simple commit</a></li>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#2-3-storing-objects">2.3 Storing objects</a></li>
  											
  									</ul>
  							
  							
  							<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#3-the-first-commit">3. The first commit</a></li>
  							
  									<ul>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#init">init</a></li>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#commit">commit</a></li>
  											
  									</ul>
  							
  							
  							<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#4-making-history">4. Making history</a></li>
  							
  									<ul>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#4-2-implementing-the-parent-chain">4.2 Implementing the parent chain</a></li>
  											
  									</ul>
  							
  							
  							<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#5-growing-trees">5 Growing trees</a></li>
  							
  									<ul>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#5-1-executable-files">5.1 Executable files</a></li>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#5-2-nested-trees">5.2 Nested trees</a></li>
  											
  									</ul>
  							
  							
  							<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#6-the-index">6. The index</a></li>
  							
  									<ul>
  											
  											<li><a href="https://ktsk.xyz/docs/programming/building-git-notes/#6-2-inspecting-git-index">6.2 Inspecting .git&#x2F;index</a></li>
  											
  									</ul>
  							
  							
  					</ul>
  			</nav>
  	</div>
  </nav>
  

      <main class="docs-content col-lg-11 col-xl-9">
        <h1>Building Git Notes</h1>
        
        <blockquote>
<p>These are my notes taken while reading the <strong>Building Git</strong> book (<a href="https://shop.jcoglan.com/building-git/">https://shop.jcoglan.com/building-git/</a>).</p>
</blockquote>
<h1 id="2-getting-to-know-git">2. Getting to know <code>.git</code></h1>
<h2 id="2-1-the-git-directory">2.1 The <code>.git</code> directory</h2>
<p>is called a <strong>repository</strong></p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">.git
├──</span><span style="color:#abb2bf;"> branches
</span><span style="color:#eb6772;">├──</span><span style="color:#abb2bf;"> config
</span><span style="color:#eb6772;">├──</span><span style="color:#abb2bf;"> description
</span><span style="color:#eb6772;">├──</span><span style="color:#abb2bf;"> HEAD
</span><span style="color:#eb6772;">├──</span><span style="color:#abb2bf;"> hooks
</span><span style="color:#eb6772;">│</span><span style="color:#abb2bf;">   ├── ...
</span><span style="color:#eb6772;">├──</span><span style="color:#abb2bf;"> info
</span><span style="color:#eb6772;">│</span><span style="color:#abb2bf;">   └── exclude
</span><span style="color:#eb6772;">├──</span><span style="color:#abb2bf;"> objects
</span><span style="color:#eb6772;">│</span><span style="color:#abb2bf;">   ├── info
</span><span style="color:#eb6772;">│</span><span style="color:#abb2bf;">   └── pack
</span><span style="color:#eb6772;">└──</span><span style="color:#abb2bf;"> refs
    </span><span style="color:#eb6772;">├──</span><span style="color:#abb2bf;"> heads
    </span><span style="color:#eb6772;">└──</span><span style="color:#abb2bf;"> tags
</span></code></pre>
<p><a href="https://shop.jcoglan.com/building-git/%5D">https://git-scm.com/docs/gitrepository-layout</a></p>
<h3 id="git-config"><code>.git/config</code></h3>
<p>A configuration settings that apply only to this directory.</p>
<h3 id="git-description"><code>.git/description</code></h3>
<p>A name of the repository, used by gitweb.</p>
<h3 id="git-head"><code>.git/HEAD</code></h3>
<p>A reference to the <em>current commit</em>, either using that commit's ID or a <em>symbolic reference</em> (<em>symref</em>).
<code>HEAD</code> is used as a parent reference for new commit.
<code>HEAD</code> is changed when checking out a branch or specific comit.
When merging, the requested branch is merged with whatever <code>HEAD</code> points at.</p>
<h3 id="git-info"><code>.git/info</code></h3>
<p>Various pieces of metadata about the repository.</p>
<h3 id="git-hooks"><code>.git/hooks</code></h3>
<p>Scripts that Git will execute as part of certain core commands.</p>
<h3 id="git-objects"><code>.git/objects</code></h3>
<p>Forms Git's <em>database</em>, place where Git stores all the content it tracks. Initial subdirectories are:</p>
<ul>
<li><code>.git/objects/pack</code> - for storing objects in an optimised format. Every object added to the database is stored in its own file at first, such an object is called <em>loose object</em>. On certain events many individual files are rolled up into a pack - a single file containing many objects in a compressed format. It needs an index describing where to find each object in a pack.</li>
<li><code>.git/objects/info</code> stores metadata about the packs for use by some of the remote protocols. Also stores links to other object stores.</li>
</ul>
<h3 id="git-refs"><code>.git/refs</code></h3>
<p>Stores various kind of pointers into the <code>.git/objects</code> database. Usually just files that contain the ID of a commit, e.g.:</p>
<ul>
<li><code>.git/refs/heads</code> store the latest commit on each local branch.</li>
<li><code>.git/refs/stash</code> references to stashed changes in <code>.git/objects</code></li>
</ul>
<h2 id="2-2-a-simple-commit">2.2 A simple commit</h2>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">git commit --message &quot;First commit.&quot;
[master (root-commit) 65b1d93] First commit.
 2 files changed, 2 insertions(+)
 create mode 100644 hello.txt
 create mode 100644 world.txt
</span></code></pre>
<p><code>root-commit</code> is a commit without any parent.</p>
<p>Newly added files after running a commit:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">├── COMMIT_EDITMSG
├── index
├── logs
│   ├── HEAD
│   └── refs
│       └── heads
│           └── master
├── objects
│   ├── 65
│   │   └── b1d9312836b1e84233b209d8d066038aead925
│   ├── 88
│   │   └── e38705fdbd3608cddbe904b67c731f3234c45b
│   ├── cc
│   │   └── 628ccd10742baea8241c5924df992b5c019f71
│   ├── ce
│   │   └── 013625030ba8dba906f756967f9e9ca394464a
│   ├── info
│   └── pack
└── refs
    ├── heads
    │   └── master
    └── tags
</span></code></pre><h3 id="git-commit-editmsg"><code>.git/COMMIT_EDITMSG</code></h3>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">cat .git/COMMIT_EDITMSG 
First commit.
</span></code></pre>
<p>Used by Git to compose commit messages. When <code>--message</code> is not passed Git opens an editor to compose the commit message. <code>.git/COMMIT_EDITMSG</code> is asked to editor to open. After closing GIt will read this file. When <code>--message</code> is passed Git still saves it in the file.</p>
<h3 id="git-index"><code>.git/index</code></h3>
<p>Binary cache that that stores information about each file in the current commit and which version of each file should be present. Updated when <code>git add</code> is run. Is used to build next commit.</p>
<h3 id="git-logs"><code>.git/logs</code></h3>
<p>Text files containing a log of every time a <em>ref</em> (<em>reference</em>, something that points to a commit, like <code>HEAD</code> or branch name) changes its value, e.g. when:</p>
<ul>
<li>making a commit</li>
<li>checking out a branch</li>
<li>merging</li>
<li>rebasing</li>
<li>...</li>
</ul>
<p>A log record for the First commit:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">0000000000000000000000000000000000000000 65b1d9312836b1e84233b209d8d066038aead925 \
Tomas Koutsky &lt;tomas@stepnivlk.net&gt; 1616955235 +0200	\
commit (initial): First commit.
</span></code></pre>
<p>This event changes refs from pointing at nothing (<code>0000...</code>) to a commit (<code>65b1...</code>). Used by <code>reflog</code> command.</p>
<h3 id="git-refs-heads-master"><code>.git/refs/heads/master</code></h3>
<p>Records which commit is at the tip of the <code>master</code> branch, which <code>HEAD</code> is currently reffering to:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">65b1d9312836b1e84233b209d8d066038aead925
</span></code></pre><h2 id="2-3-storing-objects">2.3 Storing objects</h2>
<p>Files in:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">├── objects
│   ├── 65
│   │   └── b1d9312836b1e84233b209d8d066038aead925
│   ├── 88
│   │   └── e38705fdbd3608cddbe904b67c731f3234c45b
│   ├── cc
│   │   └── 628ccd10742baea8241c5924df992b5c019f71
│   ├── ce
│   │   └── 013625030ba8dba906f756967f9e9ca394464a
</span></code></pre>
<p>are where Git stores all the objects that make up the content including commits.</p>
<p>The object from a database can be printed using <code>git cat-file -p &lt;hash&gt;</code>, e.g.:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">~&gt; git cat-file -p 65b1d9312836b1e84233b209d8d066038aead925

tree 88e38705fdbd3608cddbe904b67c731f3234c45b
author Tomas Koutsky &lt;tomas@stepnivlk.net&gt; 1616955235 +0200
committer Tomas Koutsky &lt;tomas@stepnivlk.net&gt; 1616955235 +0200

First commit.
</span></code></pre>
<p>A <em>tree</em> represenets whole tree of files as they were when given commit was made:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">~&gt; git cat-file -p 88e38705fdbd3608cddbe904b67c731f3234c45b

100644 blob ce013625030ba8dba906f756967f9e9ca394464a	hello.txt
100644 blob cc628ccd10742baea8241c5924df992b5c019f71	world.txt
</span></code></pre>
<p>Tree has one tree for every directory. Each entry in a tree is either another tree or a <em>blob</em> - regular file. Each entry in a tree lists:</p>
<ul>
<li>mode - type + permissions, 100644 is a regular, readable, non-executable file</li>
<li>type - <em>blob</em> or <em>tree</em></li>
<li>ID</li>
<li>filename</li>
</ul>
<p>For blobs, Git just stores their literal contents:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">~&gt; git cat-file -p ce013625030ba8dba906f756967f9e9ca394464a

hello
</span></code></pre>
<p>Git stores objects with first two characters forming directory in order to cope with restrictions of some operating systems when the amount of objects grows. Also it allows for faster lookup.</p>
<p>Objects are compressed:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">~&gt; cat .git/objects/ce/013625030ba8dba906f756967f9e9ca394464a 

xK��OR0c�H�����⏎ 
</span></code></pre>
<p>using DEFLATE (zlib).</p>
<p>Object can be easilly decompressed using ruby:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">~&gt; cat .git/objects/ce/01.. | ruby -r zlib -e &quot;puts Zlib::Inflate.inflate(STDIN.read)&quot;

blob 6hello
</span></code></pre>
<p>The file can be inspected further using hexdump:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">cat .git/objects/ce/01.. | ruby -r ... | hexdump -C
00000000  62 6c 6f 62 20 36 00 68  65 6c 6c 6f 0a           |blob 6.hello.|
0000000d

</span></code></pre>
<ul>
<li><code>62 6c 6f 62</code> - <code>blob</code> in ASCII</li>
<li><code>20</code> - space</li>
<li><code>36</code> <code>6</code> in ASCII</li>
<li><code>00</code> - null byte; separates the header from actual content</li>
</ul>
<p>So the blobs are stored as zlib compressed:</p>
<ul>
<li>the word <code>blob</code></li>
<li>a space</li>
<li>the lenght of the blob</li>
<li>null byte</li>
<li>the actual data</li>
</ul>
<p>Trees are different though:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">~&gt; cat .git/objects/88/e38705fdbd3608cddbe904b67c731f3234c45b | ./inflate.sh | hexdump -C

00000000  74 72 65 65 20 37 34 00  31 30 30 36 34 34 20 68  |tree 74.100644 h|
00000010  65 6c 6c 6f 2e 74 78 74  00 ce 01 36 25 03 0b a8  |ello.txt...6%...|
00000020  db a9 06 f7 56 96 7f 9e  9c a3 94 46 4a 31 30 30  |....V......FJ100|
00000030  36 34 34 20 77 6f 72 6c  64 2e 74 78 74 00 cc 62  |644 world.txt..b|
00000040  8c cd 10 74 2b ae a8 24  1c 59 24 df 99 2b 5c 01  |...t+..$.Y$..+\.|
00000050  9f 71 0a                                          |.q.|
00000053
</span></code></pre>
<p>The knowns:</p>
<ul>
<li><code>tree 74.</code> - header</li>
<li><code>100644 hello.txt</code> - a filename with mode</li>
<li><code>100644 world.txt</code> - a filename with mode</li>
</ul>
<p>Then there are IDs in packed, 20B format:</p>
<ul>
<li><code>ce 01 36 25 03 0b a8 db a9 06 f7 56 96 7f 9e 9c a3 94 46 4a</code></li>
<li><code>cc 62 8c cd 10 74 2b ae a8 24 1c 59 24 df 99 2b 5c 01 9f 71</code>
The end of filename is separated using null byte.</li>
</ul>
<p>The type of an object is implied by its mode - <code>10</code> at the beggining of <code>100644</code> indicates its a regular file, not a directory.</p>
<p>Commits are simpler:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#abb2bf;">~&gt; cat .git/objects/65/b1d9312836b1e84233b209d8d066038aead925 | ./inflate.sh

commit 184tree 88e38705fdbd3608cddbe904b67c731f3234c45b
author Tomas Koutsky &lt;tomas@stepnivlk.net&gt; 1616955235 +0200
committer Tomas Koutsky &lt;tomas@stepnivlk.net&gt; 1616955235 +0200

First commit.
</span></code></pre>
<p>It's simply a series of headers followed by the message. In this commit the headers are:</p>
<ul>
<li><code>commit 184</code> - its own header</li>
<li><code>tree</code> - reference to a single tree representing the state of files at that point in the history.</li>
<li><code>author</code> - simple metadata</li>
<li><code>committer</code> - simple metadata</li>
</ul>
<h3 id="computing-object-ids">Computing object IDs</h3>
<p>Objects are named by taking SHA-1 hash of their content prepended with a header before compressing them.
SHA-1 is a <em>cryptographic hash function</em>, it takes input of arbitrary sized string and outputs a fixed-size 20B number.
It's designed in such a way that it should be effectivelly impossible to find two inputs that has to the same output.
There are $2^{160}$ of possible object IDs so its <em>computationally infeasible</em> to find a collision.
This is property is a key to the distributed nature of Git - no two distinct objects in any repository will be given the same ID.
Also comparition becomes simple - if two objects have same ID they are same.</p>
<h3 id="problems-with-sha-1">Problems with SHA-1</h3>
<p>A hash is considered broken when there is an attack requiring less than $2^\frac{n}{2}$ ($n$ being the size of the output in bits) inputs to find a collision. For SHA-1 tht means an attack requiring fewer than $2^{80}$ steps.</p>
<p>In 2005 an attack requiring $5.9 \times 10^{20}$ steps was reported (<a href="https://www.schneier.com/blog/archives/2005/02/cryptanalysis_o.html">https://www.schneier.com/blog/archives/2005/02/cryptanalysis_o.html</a>).
In 2017 Google announced an attach requiring $9.2 \times 10^{18}$ (<a href="https://shattered.io/">https://shattered.io/</a>)</p>
<p>The migration to SHA-256 is possible however Git doesn't rely on SHA-1 as proof of trust, it's an integrity check against accidental damage. From this perspective SHA-1 is good enough.</p>
<p>Moreover for an attacker to replace an object it's not enough to find a collision, he needs to find collision with concrete blob.</p>
<h1 id="3-the-first-commit">3. The first commit</h1>
<h2 id="init"><code>init</code></h2>
<p>The very first step is <code>git init</code> the bare essentials for it are <code>objects</code> and <code>refs</code> folder and <code>HEAD</code> file. With those Git will consider the directory valid.</p>
<h2 id="commit"><code>commit</code></h2>
<ul>
<li><code>Workspace</code> is responsible for the files in the working tree - all the files that are edited directly, rather than those stored in <code>.git</code>.</li>
</ul>
<h1 id="4-making-history">4. Making history</h1>
<p>When adding second commit via Git I get:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git commit</span><span style="color:#eb6772;"> -m </span><span style="color:#9acc76;">&#39;Second commit.&#39;
</span><span style="color:#eb6772;">[master</span><span style="color:#abb2bf;"> 2d719c9] Second commit.
 </span><span style="color:#eb6772;">1</span><span style="color:#abb2bf;"> file changed, 1 insertion(+)</span><span style="color:#eb6772;">,</span><span style="color:#abb2bf;"> 1 deletion(-)
</span></code></pre>
<p>There's no <code>root-commit</code> now since it follows on from the previous commit.</p>
<p>The ID of the second commit is stored in master ref:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> cat .git/refs/heads/master
</span><span style="color:#eb6772;">2d719c90a3c181782e6e07e2fd027f90ab5de0b5
</span></code></pre>
<p>There's a parent field in the object representing second commit:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git cat-file</span><span style="color:#eb6772;"> -p</span><span style="color:#abb2bf;"> 2d719c90a3c181782e6e07e2fd027f90ab5de0b5
</span><span style="color:#eb6772;">tree</span><span style="color:#abb2bf;"> 040c6f3e807f0d433870584bc91e06b6046b955d
</span><span style="color:#eb6772;">parent</span><span style="color:#abb2bf;"> 65b1d9312836b1e84233b209d8d066038aead925
</span><span style="color:#eb6772;">author</span><span style="color:#abb2bf;"> Tomas Koutsky </span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">tomas@stepnivlk.net</span><span style="color:#adb7c9;">&gt; </span><span style="color:#db9d63;">1617213880</span><span style="color:#abb2bf;"> +0200
</span><span style="color:#eb6772;">committer</span><span style="color:#abb2bf;"> Tomas Koutsky </span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">tomas@stepnivlk.net</span><span style="color:#adb7c9;">&gt; </span><span style="color:#db9d63;">1617213880</span><span style="color:#abb2bf;"> +0200

</span><span style="color:#eb6772;">Second</span><span style="color:#abb2bf;"> commit.
</span></code></pre>
<p>The ID behind parent points to the first commit:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git cat-file</span><span style="color:#eb6772;"> -p</span><span style="color:#abb2bf;"> 65b1d9312836b1e84233b209d8d066038aead925
</span><span style="color:#eb6772;">tree</span><span style="color:#abb2bf;"> 88e38705fdbd3608cddbe904b67c731f3234c45b
</span><span style="color:#eb6772;">author</span><span style="color:#abb2bf;"> Tomas Koutsky </span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">tomas@stepnivlk.net</span><span style="color:#adb7c9;">&gt; </span><span style="color:#db9d63;">1616955235</span><span style="color:#abb2bf;"> +0200
</span><span style="color:#eb6772;">committer</span><span style="color:#abb2bf;"> Tomas Koutsky </span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">tomas@stepnivlk.net</span><span style="color:#adb7c9;">&gt; </span><span style="color:#db9d63;">1616955235</span><span style="color:#abb2bf;"> +0200

</span><span style="color:#eb6772;">First</span><span style="color:#abb2bf;"> commit.
</span></code></pre>
<p>So each commit made after the root one has parent field pointing to previous commit. This allows for understanding of how commits are <em>causually connected</em>.</p>
<p>Each tree contains the snapshot of all the files.
First tree:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git cat-file</span><span style="color:#eb6772;"> -p</span><span style="color:#abb2bf;"> 88e38705fdbd3608cddbe904b67c731f3234c45b
</span><span style="color:#eb6772;">100644</span><span style="color:#abb2bf;"> blob ce013625030ba8dba906f756967f9e9ca394464a	hello.txt
</span><span style="color:#eb6772;">100644</span><span style="color:#abb2bf;"> blob cc628ccd10742baea8241c5924df992b5c019f71	world.txt
</span></code></pre>
<p>Second tree:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git cat-file</span><span style="color:#eb6772;"> -p</span><span style="color:#abb2bf;"> 040c6f3e807f0d433870584bc91e06b6046b955d
</span><span style="color:#eb6772;">100644</span><span style="color:#abb2bf;"> blob e019be006cf33489e2d0177a3837a2384eddebc5	hello.txt
</span><span style="color:#eb6772;">100644</span><span style="color:#abb2bf;"> blob cc628ccd10742baea8241c5924df992b5c019f71	world.txt
</span></code></pre>
<p><code>world.txt</code> is same object with same ID as its content didn't change and IDs of objects are derived from their contents.</p>
<p>Thus Git only creates new blobs when files have their content changed. Files with same content will point to same blob even when those files appear in many trees across many commits.</p>
<h2 id="4-2-implementing-the-parent-chain">4.2 Implementing the <code>parent</code> chain</h2>
<p><code>.git/HEAD</code> needs to be updated when storing commits however it has to be done in safe, atomic way as there may be multiple readers. Multiple writers are considered as an error. This can be tackled using a lockfile.</p>
<h1 id="5-growing-trees">5 Growing trees</h1>
<h2 id="5-1-executable-files">5.1 Executable files</h2>
<p>When commiting executable file:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> touch cruel.txt
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> chmod +x cruel.txt 
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git add cruel.txt 
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git commit</span><span style="color:#eb6772;"> -m </span><span style="color:#9acc76;">&#39;Third commit.&#39;
</span><span style="color:#eb6772;">[master</span><span style="color:#abb2bf;"> 91c525a] Third commit.
 </span><span style="color:#eb6772;">1</span><span style="color:#abb2bf;"> file changed, 0 insertions(+)</span><span style="color:#eb6772;">,</span><span style="color:#abb2bf;"> 0 deletions(-)
 </span><span style="color:#eb6772;">create</span><span style="color:#abb2bf;"> mode 100755 cruel.txt
</span></code></pre>
<p>The mode is <code>100755</code> instead of <code>100644</code> and it's stored in the tree:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git cat-file</span><span style="color:#eb6772;"> -p</span><span style="color:#abb2bf;"> HEAD^{tree}
</span><span style="color:#eb6772;">100755</span><span style="color:#abb2bf;"> blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	cruel.txt
</span><span style="color:#eb6772;">100644</span><span style="color:#abb2bf;"> blob e019be006cf33489e2d0177a3837a2384eddebc5	hello.txt
</span><span style="color:#eb6772;">100644</span><span style="color:#abb2bf;"> blob cc628ccd10742baea8241c5924df992b5c019f71	world.txt
</span></code></pre>
<p>The mode is in base 8, it makes it easier to read in the compact format. First 4 bits are file type related, others are permissions (special, user, group other).
E.g. in <code>100644</code>:</p>
<ul>
<li><code>10</code> - regular file</li>
<li><code>0</code> - no special permissions</li>
<li><code>6</code> - owner can rw</li>
<li><code>4</code> - members of the group can read</li>
<li><code>4</code> - others can read
In <code>100755</code>:</li>
<li><code>7</code> - owner can rw + execute</li>
<li><code>5</code> - members of the group can r + execute</li>
<li><code>5</code> - others can r + execute</li>
</ul>
<p>Git only uses very restricted permissions - whether owner can execute, rest is thrown out:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> touch out.txt
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> chmod 655 out.txt 
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git add out.txt 
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git commit</span><span style="color:#eb6772;"> -m </span><span style="color:#9acc76;">&#39;Forth commit.&#39;
</span><span style="color:#eb6772;">[master</span><span style="color:#abb2bf;"> 27df932] Forth commit.
 </span><span style="color:#eb6772;">1</span><span style="color:#abb2bf;"> file changed, 0 insertions(+)</span><span style="color:#eb6772;">,</span><span style="color:#abb2bf;"> 0 deletions(-)
 </span><span style="color:#eb6772;">create</span><span style="color:#abb2bf;"> mode 100644 out.txt
</span></code></pre>
<p>Thus Git only has two modes - <code>100644</code> and <code>100755</code>.</p>
<h2 id="5-2-nested-trees">5.2 Nested trees</h2>
<p>Trees can be arbitrarily nested:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> mkdir</span><span style="color:#eb6772;"> -p</span><span style="color:#abb2bf;"> a/b
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> touch a/b/c.txt
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git add .
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git commit</span><span style="color:#eb6772;"> -m </span><span style="color:#9acc76;">&#39;First commit.&#39;
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git cat-file</span><span style="color:#eb6772;"> -p</span><span style="color:#abb2bf;"> HEAD^{tree}

</span><span style="color:#eb6772;">040000</span><span style="color:#abb2bf;"> tree c4a644afb090a8303bdb28306a2f803017551f25	a
</span></code></pre>
<p>Hexdump:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> cat .git/objects/c4/a644afb090a8303bdb28306a2f803017551f25 </span><span style="color:#adb7c9;">| </span><span style="color:#eb6772;">./inflate.sh </span><span style="color:#adb7c9;">| </span><span style="color:#eb6772;">hexdump -C
00000000</span><span style="color:#abb2bf;">  74 72 65 65 20 32 38 00  34 30 30 30 30 20 62 00  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">tree</span><span style="color:#abb2bf;"> 28.40000 b.</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000010</span><span style="color:#abb2bf;">  17 21 a7 a9 1e 87 f5 41  3c 84 2a 9c 5c e7 3f 67  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">.!.....A</span><span style="color:#adb7c9;">&lt;</span><span style="color:#abb2bf;">.</span><span style="color:#adb7c9;">*</span><span style="color:#abb2bf;">.</span><span style="color:#5ebfcc;">\.</span><span style="color:#adb7c9;">?</span><span style="color:#abb2bf;">g</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000020</span><span style="color:#abb2bf;">  44 59 e9 2b 0a                                    </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">DY.+.</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000025
</span></code></pre>
<p>The mode is <code>40000</code>. In Unix, directories have file type bits set to <code>4</code> and permissions to <code>755</code>. Git ingones all the permissions and just stores <code>40000</code> to indicate it's a directory.
<code>a</code> of course points to <code>b</code> - another tree.</p>
<p>The content of a tree is just a list of IDs and names of this contents and SHA-1 hashes the content. Thus when two trees have same IDs it means all their contents are same, recursively.
This method of storing a tree of information where each tree is labelled with the has of its children is called a Merkle tree.</p>
<p>Entries in trees have to be sorted in order to compare those effectively. Git sorts the file list for the entire project before building trees, thus it sorts following entries:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">foo </span><span style="font-style:italic;color:#5f697a;"># dir with bar.txt entry
</span><span style="color:#eb6772;">foo.txt
</span></code></pre>
<p>as:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">foo.txt
foo
</span></code></pre>
<p>It sees <code>foo</code> as <code>foo/bar.txt</code>.</p>
<p>In Git, the <code>add</code> command reads the working tree, stores blobs in the database and adds them to the index. <code>commit</code> reads the index to create trees. The index is stored as flat list of paths.</p>
<h1 id="6-the-index">6. The index</h1>
<p>Current <code>commit</code> implementation reads and hashes every file in the project in order to store blobs, that's ineffective. Usually, in larger projects, only small subset of files is changed in commit. Moreover, the current implementation is cumbersome to use. The user should control what goes in a commit.</p>
<p>The <code>add</code> command and the index solve the problem by providing a cache of all the blobs representing the current state of the project. It contains the object IDs of the blobs corresponding the the current files plus a lot of information from the filesystem (size of files, timestamps).</p>
<h2 id="6-2-inspecting-git-index">6.2 Inspecting <code>.git/index</code></h2>
<p>Let's consider following scenario:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> touch file.txt
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git status
</span><span style="color:#eb6772;">On</span><span style="color:#abb2bf;"> branch master

</span><span style="color:#eb6772;">No</span><span style="color:#abb2bf;"> commits yet

</span><span style="color:#eb6772;">Untracked</span><span style="color:#abb2bf;"> files:
  (</span><span style="color:#eb6772;">use </span><span style="color:#9acc76;">&quot;git add &lt;file&gt;...&quot;</span><span style="color:#abb2bf;"> to include in what will be committed)
	</span><span style="color:#eb6772;">file.txt

nothing</span><span style="color:#abb2bf;"> added to commit but untracked files present (use </span><span style="color:#9acc76;">&quot;git add&quot;</span><span style="color:#abb2bf;"> to track)
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git add file.txt
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git status
</span><span style="color:#eb6772;">On</span><span style="color:#abb2bf;"> branch master

</span><span style="color:#eb6772;">No</span><span style="color:#abb2bf;"> commits yet

</span><span style="color:#eb6772;">Changes</span><span style="color:#abb2bf;"> to be committed:
  (</span><span style="color:#eb6772;">use </span><span style="color:#9acc76;">&quot;git rm --cached &lt;file&gt;...&quot;</span><span style="color:#abb2bf;"> to unstage)
	</span><span style="color:#eb6772;">new</span><span style="color:#abb2bf;"> file:   file.txt

</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> echo </span><span style="color:#9acc76;">&quot;new content&quot; </span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> file.txt
</span><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git status
</span><span style="color:#eb6772;">On</span><span style="color:#abb2bf;"> branch master

</span><span style="color:#eb6772;">No</span><span style="color:#abb2bf;"> commits yet

</span><span style="color:#eb6772;">Changes</span><span style="color:#abb2bf;"> to be committed:
  (</span><span style="color:#eb6772;">use </span><span style="color:#9acc76;">&quot;git rm --cached &lt;file&gt;...&quot;</span><span style="color:#abb2bf;"> to unstage)
	</span><span style="color:#eb6772;">new</span><span style="color:#abb2bf;"> file:   file.txt

</span><span style="color:#eb6772;">Changes</span><span style="color:#abb2bf;"> not staged for commit:
  (</span><span style="color:#eb6772;">use </span><span style="color:#9acc76;">&quot;git add &lt;file&gt;...&quot;</span><span style="color:#abb2bf;"> to update what will be committed)
  (</span><span style="color:#eb6772;">use </span><span style="color:#9acc76;">&quot;git restore &lt;file&gt;...&quot;</span><span style="color:#abb2bf;"> to discard changes in working directory)
	</span><span style="color:#eb6772;">modified:</span><span style="color:#abb2bf;">   file.txt
</span></code></pre>
<p>What does it mean for change to be <em>staged</em>?</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> hexdump</span><span style="color:#eb6772;"> -C</span><span style="color:#abb2bf;"> .git/index
</span><span style="color:#eb6772;">00000000</span><span style="color:#abb2bf;">  44 49 52 43 00 00 00 02  00 00 00 01 60 66 e1 3d  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">DIRC........</span><span style="color:#9acc76;">`</span><span style="color:#eb6772;">f.</span><span style="color:#adb7c9;">=|
</span><span style="color:#eb6772;">00000010</span><span style="color:#9acc76;">  15 7d 40 fe 60 66 e1 3d  15 7d 40 fe 00 00 00 1a  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">.</span><span style="color:#9acc76;">}</span><span style="color:#eb6772;">@.</span><span style="color:#9acc76;">`f.=.}@.....</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000020</span><span style="color:#abb2bf;">  00 1f 40 63 00 00 81 a4  00 00 03 e8 00 00 03 e8  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">..@c............</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000030</span><span style="color:#abb2bf;">  00 00 00 00 e6 9d e2 9b  b2 d1 d6 43 4b 8b 29 ae  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">...........CK.</span><span style="color:#abb2bf;">)</span><span style="color:#5ebfcc;">.</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000040</span><span style="color:#abb2bf;">  77 5a d8 c2 e4 8c 53 91  00 08 66 69 6c 65 2e 74  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">wZ....S...file.t</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000050</span><span style="color:#abb2bf;">  78 74 00 00 4a a4 ed 90  d2 ca 32 07 52 b6 39 d3  </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">xt..J.....2.R.9.</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000060</span><span style="color:#abb2bf;">  e4 31 4b bb fc 72 8e 2d                           </span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">.1K..r.-</span><span style="color:#adb7c9;">|
</span><span style="color:#eb6772;">00000068
</span></code></pre>
<p>By checking <a href="https://git-scm.com/docs/index-format">https://git-scm.com/docs/index-format</a> I ca see that the index starts with:</p>
<ul>
<li>A 12-byte header consisting of
<ul>
<li>4-byte signature:
<ul>
<li>The signature is { 'D', 'I', 'R', 'C' } (stands for &quot;dircache&quot;)</li>
</ul>
</li>
<li>4-byte version number:
<ul>
<li>The current supported versions are 2, 3 and 4.</li>
</ul>
</li>
<li>32-bit number of index entries.</li>
</ul>
</li>
</ul>
<p>Thus the header part of the dump is:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">44</span><span style="color:#abb2bf;"> 49 52 43 00 00 00 02 00 00 00 01
</span><span style="color:#eb6772;">-----------</span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">-----------</span><span style="color:#adb7c9;">|</span><span style="color:#eb6772;">-----------
   DIRC    </span><span style="color:#adb7c9;">|    </span><span style="color:#eb6772;">v2     </span><span style="color:#adb7c9;">|  </span><span style="color:#eb6772;">1</span><span style="color:#abb2bf;"> entry
</span></code></pre>
<p>The header is followed by entries themselves, each entry starts with ten 4-byte <code>stat</code> numbers:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">ctime</span><span style="color:#abb2bf;"> seconds, the last time a file</span><span style="color:#9acc76;">&#39;s metadata changed
ctime nanosecond fractions
mtime seconds, the last time a file&#39;</span><span style="color:#abb2bf;">s data changed
</span><span style="color:#eb6772;">mtime</span><span style="color:#abb2bf;"> nanosecond fractions
</span><span style="color:#eb6772;">dev
ino
mode
uid
gid
file</span><span style="color:#abb2bf;"> size
</span></code></pre>
<ul>
<li><em>ctame</em> - time when content or metadata was changed</li>
<li><em>mtame</em> - time when content was changed</li>
<li><em>dev</em> - ID of hardware storage</li>
<li><em>non</em> - number of inode</li>
</ul>
<p>To list all the files in the index:</p>
<pre style="background-color:#2b303b;">
<code class="language-sh" data-lang="sh"><span style="color:#eb6772;">~</span><span style="color:#adb7c9;">&gt;</span><span style="color:#abb2bf;"> git ls-files</span><span style="color:#eb6772;"> --stage
100644</span><span style="color:#abb2bf;"> e69de29bb2d1d6434b8b29ae775ad8c2e48c5391 0	file.txt
</span></code></pre>
        
        
<div class="docs-navigation d-flex justify-content-between">
  
  
  
  
  
    
    
    
    
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
            
              
              <a href="https:&#x2F;&#x2F;ktsk.xyz&#x2F;docs&#x2F;home&#x2F;intro&#x2F;">
                <div class="card my-1">
                  <div class="card-body py-2">
                    &larr; Intro
                  </div>
                </div>
              </a>
            
            
            
          
        
      
    
  

  
  
  
  
  
    
    
    
      
      
        
      
    
      
      
        
      
    
      
      
        
          
          
          <a class="ms-auto" href="https:&#x2F;&#x2F;ktsk.xyz&#x2F;docs&#x2F;cheatsheets&#x2F;git-cheatsheet&#x2F;">
            <div class="card my-1">
              <div class="card-body py-2">
                Git cheatsheet &rarr;
              </div>
            </div>
          </a>
          
          
          
        
      
    
      
      
        
      
    
      
      
        
      
    
  
</div>

      </main>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Within Cells Interlinked.</li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

  
<script src="https://ktsk.xyz/js/main.js" defer></script>

  <script src="https://ktsk.xyz/plugins/elasticlunr.min.js" defer></script>
  <script src="https://ktsk.xyz/search_index.en.js" defer></script>
  <script src="https://ktsk.xyz/js/search.js" defer></script>

  
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</body>
</html>
